{"version":3,"file":"ChangesSidebar.js","sourceRoot":"","sources":["../../../../../front_end/changes/ChangesSidebar.js"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2017 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../common/common.js';\nimport * as i18n from '../i18n/i18n.js';\nimport * as Snippets from '../snippets/snippets.js';\nimport * as UI from '../ui/ui.js';\nimport * as Workspace from '../workspace/workspace.js';\nimport * as WorkspaceDiff from '../workspace_diff/workspace_diff.js';\n\nexport const UIStrings = {\n  /**\n  *@description Name of an item from source map\n  *@example {compile.html} PH1\n  */\n  sFromSourceMap: '{PH1} (from source map)',\n};\nconst str_ = i18n.i18n.registerUIStrings('changes/ChangesSidebar.js', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport class ChangesSidebar extends UI.Widget.Widget {\n  /**\n   * @param {!WorkspaceDiff.WorkspaceDiff.WorkspaceDiffImpl} workspaceDiff\n   */\n  constructor(workspaceDiff) {\n    super();\n    this._treeoutline = new UI.TreeOutline.TreeOutlineInShadow();\n    this._treeoutline.setFocusable(false);\n    this._treeoutline.registerRequiredCSS('changes/changesSidebar.css', {enableLegacyPatching: true});\n    this._treeoutline.setComparator((a, b) => a.titleAsText().compareTo(b.titleAsText()));\n    this._treeoutline.addEventListener(UI.TreeOutline.Events.ElementSelected, this._selectionChanged, this);\n    UI.ARIAUtils.markAsTablist(this._treeoutline.contentElement);\n\n    this.element.appendChild(this._treeoutline.element);\n\n    /** @type {!Map<!Workspace.UISourceCode.UISourceCode, !UISourceCodeTreeElement>} */\n    this._treeElements = new Map();\n    this._workspaceDiff = workspaceDiff;\n    this._workspaceDiff.modifiedUISourceCodes().forEach(this._addUISourceCode.bind(this));\n    this._workspaceDiff.addEventListener(\n        WorkspaceDiff.WorkspaceDiff.Events.ModifiedStatusChanged, this._uiSourceCodeMofiedStatusChanged, this);\n  }\n\n  /**\n   * @param {!Workspace.UISourceCode.UISourceCode} uiSourceCode\n   * @param {boolean=} omitFocus\n   */\n  selectUISourceCode(uiSourceCode, omitFocus) {\n    const treeElement = this._treeElements.get(uiSourceCode);\n    if (!treeElement) {\n      return;\n    }\n    treeElement.select(omitFocus);\n  }\n\n  /**\n   * @return {?Workspace.UISourceCode.UISourceCode}\n   */\n  selectedUISourceCode() {\n    // @ts-ignore uiSourceCode seems to be dynamically attached.\n    return this._treeoutline.selectedTreeElement ? this._treeoutline.selectedTreeElement.uiSourceCode : null;\n  }\n\n  _selectionChanged() {\n    this.dispatchEventToListeners(Events.SelectedUISourceCodeChanged);\n  }\n\n  /**\n   * @param {!Common.EventTarget.EventTargetEvent} event\n   */\n  _uiSourceCodeMofiedStatusChanged(event) {\n    if (event.data.isModified) {\n      this._addUISourceCode(event.data.uiSourceCode);\n    } else {\n      this._removeUISourceCode(event.data.uiSourceCode);\n    }\n  }\n\n  /**\n   * @param {!Workspace.UISourceCode.UISourceCode} uiSourceCode\n   */\n  _removeUISourceCode(uiSourceCode) {\n    const treeElement = this._treeElements.get(uiSourceCode);\n    this._treeElements.delete(uiSourceCode);\n    if (this._treeoutline.selectedTreeElement === treeElement) {\n      const nextElementToSelect = treeElement.previousSibling || treeElement.nextSibling;\n      if (nextElementToSelect) {\n        nextElementToSelect.select(true);\n      } else {\n        treeElement.deselect();\n        this._selectionChanged();\n      }\n    }\n    if (treeElement) {\n      this._treeoutline.removeChild(treeElement);\n      treeElement.dispose();\n    }\n    if (this._treeoutline.rootElement().childCount() === 0) {\n      this._treeoutline.setFocusable(false);\n    }\n  }\n\n  /**\n   * @param {!Workspace.UISourceCode.UISourceCode} uiSourceCode\n   */\n  _addUISourceCode(uiSourceCode) {\n    const treeElement = new UISourceCodeTreeElement(uiSourceCode);\n    this._treeElements.set(uiSourceCode, treeElement);\n    this._treeoutline.setFocusable(true);\n    this._treeoutline.appendChild(treeElement);\n    if (!this._treeoutline.selectedTreeElement) {\n      treeElement.select(true);\n    }\n  }\n}\n\n/**\n * @enum {symbol}\n */\nexport const Events = {\n  SelectedUISourceCodeChanged: Symbol('SelectedUISourceCodeChanged')\n};\n\nexport class UISourceCodeTreeElement extends UI.TreeOutline.TreeElement {\n  /**\n   * @param {!Workspace.UISourceCode.UISourceCode} uiSourceCode\n   */\n  constructor(uiSourceCode) {\n    super();\n    this.uiSourceCode = uiSourceCode;\n    this.listItemElement.classList.add('navigator-' + uiSourceCode.contentType().name() + '-tree-item');\n    UI.ARIAUtils.markAsTab(this.listItemElement);\n\n    let iconType = 'largeicon-navigator-file';\n    if (Snippets.ScriptSnippetFileSystem.isSnippetsUISourceCode(this.uiSourceCode)) {\n      iconType = 'largeicon-navigator-snippet';\n    }\n    const defaultIcon = UI.Icon.Icon.create(iconType, 'icon');\n    this.setLeadingIcons([defaultIcon]);\n\n    this._eventListeners = [\n      uiSourceCode.addEventListener(Workspace.UISourceCode.Events.TitleChanged, this._updateTitle, this),\n      uiSourceCode.addEventListener(Workspace.UISourceCode.Events.WorkingCopyChanged, this._updateTitle, this),\n      uiSourceCode.addEventListener(Workspace.UISourceCode.Events.WorkingCopyCommitted, this._updateTitle, this)\n    ];\n\n    this._updateTitle();\n  }\n\n  _updateTitle() {\n    let titleText = this.uiSourceCode.displayName();\n    if (this.uiSourceCode.isDirty()) {\n      titleText = '*' + titleText;\n    }\n    this.title = titleText;\n\n    let tooltip = this.uiSourceCode.url();\n    if (this.uiSourceCode.contentType().isFromSourceMap()) {\n      tooltip = i18nString(UIStrings.sFromSourceMap, {PH1: this.uiSourceCode.displayName()});\n    }\n    this.tooltip = tooltip;\n  }\n\n  dispose() {\n    Common.EventTarget.EventTarget.removeEventListeners(this._eventListeners);\n  }\n}\n"]}