{"version":3,"file":"LighthouseReportSelector.js","sourceRoot":"","sources":["../../../../../front_end/lighthouse/LighthouseReportSelector.js"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2018 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../common/common.js';\nimport * as i18n from '../i18n/i18n.js';\nimport * as UI from '../ui/ui.js';\n\nimport * as ReportRenderer from './LighthouseReporterTypes.js';  // eslint-disable-line no-unused-vars\n\nexport const UIStrings = {\n  /**\n  *@description Title of combo box in audits report selector\n  */\n  reports: 'Reports',\n  /**\n  *@description New report item label in Lighthouse Report Selector\n  */\n  newReport: '(new report)',\n};\nconst str_ = i18n.i18n.registerUIStrings('lighthouse/LighthouseReportSelector.js', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nexport class ReportSelector {\n  /**\n   * @param {function():void} renderNewLighthouseView\n   */\n  constructor(renderNewLighthouseView) {\n    this._renderNewLighthouseView = renderNewLighthouseView;\n    this._newLighthouseItem = document.createElement('option');\n    this._comboBox = new UI.Toolbar.ToolbarComboBox(\n        this._handleChange.bind(this), i18nString(UIStrings.reports), 'lighthouse-report');\n    this._comboBox.setMaxWidth(180);\n    this._comboBox.setMinWidth(140);\n    this._itemByOptionElement = new Map();\n    this._setEmptyState();\n  }\n\n  _setEmptyState() {\n    this._comboBox.selectElement().removeChildren();\n\n    this._comboBox.setEnabled(false);\n    this._newLighthouseItem = document.createElement('option');\n    this._newLighthouseItem.label = i18nString(UIStrings.newReport);\n    this._comboBox.selectElement().appendChild(this._newLighthouseItem);\n    this._comboBox.select(this._newLighthouseItem);\n  }\n\n  /**\n   * @param {!Event} event\n   */\n  _handleChange(event) {\n    const item = this._selectedItem();\n    if (item) {\n      item.select();\n    } else {\n      this._renderNewLighthouseView();\n    }\n  }\n\n  /**\n   * @return {!Item}\n   */\n  _selectedItem() {\n    const option = this._comboBox.selectedOption();\n    return this._itemByOptionElement.get(option);\n  }\n\n  /**\n   * @return {boolean}\n   */\n  hasCurrentSelection() {\n    return Boolean(this._selectedItem());\n  }\n\n  /**\n   * @return {boolean}\n   */\n  hasItems() {\n    return this._itemByOptionElement.size > 0;\n  }\n\n  /**\n   * @return {!UI.Toolbar.ToolbarComboBox}\n   */\n  comboBox() {\n    return this._comboBox;\n  }\n\n  /**\n   * @param {!Item} item\n   */\n  prepend(item) {\n    const optionEl = item.optionElement();\n    const selectEl = this._comboBox.selectElement();\n\n    this._itemByOptionElement.set(optionEl, item);\n    selectEl.insertBefore(optionEl, selectEl.firstElementChild);\n    this._comboBox.setEnabled(true);\n    this._comboBox.select(optionEl);\n    item.select();\n  }\n\n  clearAll() {\n    for (const elem of this._comboBox.options()) {\n      if (elem === this._newLighthouseItem) {\n        continue;\n      }\n\n      this._itemByOptionElement.get(elem).delete();\n      this._itemByOptionElement.delete(elem);\n    }\n\n    this._setEmptyState();\n  }\n\n  selectNewReport() {\n    this._comboBox.select(this._newLighthouseItem);\n  }\n}\n\nexport class Item {\n  /**\n   * @param {!ReportRenderer.ReportJSON} lighthouseResult\n   * @param {function():void} renderReport\n   * @param {function():void} showLandingCallback\n   */\n  constructor(lighthouseResult, renderReport, showLandingCallback) {\n    this._lighthouseResult = lighthouseResult;\n    this._renderReport = renderReport;\n    this._showLandingCallback = showLandingCallback;\n\n    const url = new Common.ParsedURL.ParsedURL(lighthouseResult.finalUrl);\n    const timestamp = lighthouseResult.fetchTime;\n    this._element = document.createElement('option');\n    this._element.label = `${new Date(timestamp).toLocaleTimeString()} - ${url.domain()}`;\n  }\n\n  select() {\n    this._renderReport();\n  }\n\n  /**\n   * @return {!Element}\n   */\n  optionElement() {\n    return this._element;\n  }\n\n  delete() {\n    if (this._element) {\n      this._element.remove();\n    }\n    this._showLandingCallback();\n  }\n}\n"]}